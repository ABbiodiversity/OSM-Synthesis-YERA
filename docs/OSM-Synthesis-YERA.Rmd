---
title: "Yellow Rail in Alberta's Oil Sands Region"
author: "Richard Hedley, Marcus Becker, Erin Bayne"
date: "Updated: February 4, 2022"
output:
  bookdown::html_document2:
    highlight: zenburn
    number_sections: yes
    self_contained: yes
    theme: paper
    toc: yes
    toc_depth: 4
    toc_float: yes
  html_document:
    df_print: paged
    toc: yes
    toc_depth: '4'
  pdf_document:
    toc: yes
  word_document:
    toc: yes
    toc_depth: '4'
always_allow_html: yes
urlcolor: blue
---

<style>
    body .main-container {
        max-width: 1350px;
    }
</style>

```{r setup, include=TRUE, echo=FALSE, message=FALSE, warning=FALSE, eval=TRUE}

# Load libraries
library(tidyverse)
library(crosstalk) # Special branch of GH crosstalk repo required (filter-select-default)
library(knitr)
library(here)
library(sf)
library(raster)
library(leaflet)
library(leaflet.extras)
library(RColorBrewer)
#library(DT)
library(grid)
library(abmi.themes)
library(purrr)

# Load functions
source(here("./src/osm-synthesis-yera-functions_2019_09_27.R"))

# Set global options for figures 
knitr::opts_chunk$set(out.width='70%', fig.align = "center")

select <- dplyr::select

add_abmi_fonts()

```

```{r load-data, include=TRUE, echo=FALSE, message=FALSE, warning=FALSE, eval=TRUE}

# Spatial data

# Preferred habitat raster (LAPR)
ras_prefhab <- raster(here("./data/base/spatial/yera_prefhab_250m.tif"))
# Abundance predictions (McClelland Lake)
ras_pred <- raster(here("./data/base/spatial/final_yera_pred_mcclelland.tif"))
# Alberta's OSR
sf_osr <- st_read(here("./data/base/spatial/AB_OSR.shp"), quiet = TRUE)
# Lease sites
sf_lease <- st_read(here("./data/base/spatial/AB_lease-sites.shp"), quiet = TRUE) %>%
  select(OBJECTID, Project_Na, Scheme_Pro) %>%
  mutate_if(is.factor, as.character) %>%
  mutate(Name = ifelse(is.na(Project_Na), Scheme_Pro, "Jackpine Mine Phase 2")) %>%
  select(OBJECTID, Name) %>%
  # Choose only relevant ones near McClelland Lake Fen
  filter(str_detect(Name, "Fort|Aurora|Muskeg|Jackpine|Kearl")) %>%
  st_transform("+init=epsg:4326") %>%
  # Join in Tabulate Area results from ArcGIS re: habitat suitability
  left_join(read_csv(here("./data/base/hab-suit_lease_tab-area.csv")))

# Site metadata
df_meta <- read_csv(here("./data/lookup/yera_ss-meta_2013-18.csv"))
# YERA occupancy
df_occupy <- read_csv(here("./data/processed/yera_occupy_2013-21_new.csv"))

# Occupancy modeling output
load(here("./results/occupancy/MultiYearOccupancyOutput_2013-21.RData"))

```
<br>
<br>

# Introduction

Yellow Rails (*Coturnicops noveboracensis*) are one of the most secretive and poorly understood bird species in North America. They are migratory, spending the months of May until September at their breeding grounds throughout Canada, and the rest of the year in wetlands along the southeast coast of the United States. The remoteness of their wetland breeding habitats and their nocturnal activity patterns render them poorly sampled by standard bird monitoring efforts. A lack of information regarding distribution, population size, population trends, and basic biology has been a primary reason for conservation concern. In addition, there are concerns surrounding loss of their preferred wetland habitats, based on documented cases of human activities reducing or eliminating the suitability of previously occupied wetlands. The purpose of this report is to summarize findings from monitoring efforts in the Oil Sands Region (OSR) of Alberta, synthesize available knowledge into tools for future management, and highlight priorities for further research.

<br>
```{r rail, include=TRUE, echo=FALSE, message=FALSE, warning=FALSE, eval=TRUE, out.width='40%', fig.cap="Yellow Rail. Photo credit: Audobon."}

include_graphics(here("./docs/pics/yellow-rail.jpg"))

```

## At Issue

Current knowledge of the breeding habits of Yellow Rails suggests that they primarily breed in graminoid fens, with breeding territories characterized by 0 to 30-cm of standing water and dense cover of grasses and sedges (Stenzel, 1982; Bookhout and Stenzel, 1987; Austin and Buhl, 2013; Leston and Bookhout, 2015). Much of this breeding territory is in remote areas of the boreal natural region (Wells and Blancher, 2011).  

The two main threats facing the Yellow Rail in the OSR are:

+ the **direct effects** of surface mining, in which their habitats are removed;
+ the **indirect effects** of altered hydrology due to development, which may affect the suitability of habitat well beyond the footprint of development (Environment Canada, 2013).

## Management Goals

Yellow Rail abundance and occupancy can fluctuate from year to year at a wetland, which is thought to be driven by inter-annual variation in water levels. Nevertheless, some wetlands in the OSR are reliably occupied by large numbers of Yellow Rails every year (dozens of individuals, E.Bayne *unpublished*). As such, a management goal for this species in the OSR is to identify Yellow Rail breeding sites and prioritize these for conservation. As part of this, monitoring must be focused on understanding both the direct and indirect effects of development on key habitats, such as the mineable regions around McClelland Lake (as required by the Environmental Protection and Enhancement Act).   

# Monitoring and Research Objectives

+ **Identify key breeding sites**

Currently, Yellow Rails have been found at approximately 200 survey points in the OSR. A habitat map constructed from these data can be used to predict additional breeding sites and estimate population sizes and potential threats. Predicted sites should be surveyed when possible to verify presence/absence. Regions that are potentially important but which have not been thoroughly surveyed include the wetlands surrounding Lake Clair in Wood Buffalo National Park, the entire western region of the OSR corresponding to the Peace River Oil Sands, and most wetlands not within 10-km of a road.

Identification of new sites can be accomplished by visiting sites of high predicted habitat suitability to confirm presence/absence of Yellow Rails. In particular, visiting areas with large expanses of predicted suitable habitat is important, as these locations are likely to harbour significant populations of Yellow Rails.

+ **Refine population estimates**

Existing population estimates put the population of Yellow Rail at 10,000 - 25,000 individuals globally. The population in Alberta has been estimated at 500 pairs. However, this is likely an underestimate, because recent surveys have found nearly 300 males (with an assumed equal number of females) in the surveyed areas of the OSR, which itself covers only about 20% of the province (E.Bayne, unpublished data). The degree of underestimation remains unknown and is the focus of ongoing work. In this report we present preliminary results from Hedley et al. (*in prep*) that report a new regional population estimate for the species based on monitoring from 2013-2018. 

+ **Continue research on movement ecology**

Yellow Rails migrate from Canada to the southeastern United States each year. Beyond this, little is known about their movements. The consensus view regarding the conservation of migratory species is that successful conservation efforts must focus on the full annual cycle. 

Populations in Quebec are thought to undertake a molt migration in the late summer, moving dozens of kilometers from their breeding grounds to molt. It is not known if Yellow Rails in Alberta do the same, but if they do, it may mean their habitat needs extend well beyond their breeding territories.

Yellow Rails are also notorious for their lack of site fidelity. Rates of recapture of the same individual in successive years are <1% (K. Drake, Pers. Comm.), suggesting that the rails move around between years. This behaviour is thought to have evolved as an adaptation to ephemeral wetland habitats, which can become unsuitable if water levels are too high or too low. The low (<1%) interannual recapture rate is a practical barrier to long-distance tracking, since most tracking devices require recapture. Those that remotely transmit data via satellite are currently too large to attach to Yellow Rails. An intermediate option is a GPS tag with the option of data download via short-range radio receivers, and this option is currently being explored.

+ **Assess threats posed in the OSR**

Several oil sands mines (or proposed mines) abut or overlap significant patches of potential Yellow Rail habitat. Research is ongoing to place these threats within regional and global contexts. This is proceeding in two main ways: first, by continuing to survey suitable habitat on and near leases to determine if the predicted habitat is actually occupied; and second, by estimating the percentage of predicted habitat that occurs on, near, and off lease, and using these percentages to estimate proportion of the regional and global population that are threatened by development. Additionally, existing water depth data will be used to examine how Yellow Rails respond to changes in water levels between years, and findings can be used to develop better mitigation strategies. 

+ **Develop tools for Yellow Rail management**

Finally, research findings can be distilled into tools for land managers to improve Yellow Rail conservation in the future. In this report we present a predictive habitat suitability map (30-m raster resolution) that can be used to assess threats to Yellow Rail in the region and identify new potential breeding sites. In addition, we present findings of predicted rail abundance using data from remote satellite imagery (MacLeod, 2019). This method represents a promising avenue of future ecological research, as increased availability of remotely sensed landcover data at large scales, coupled with improved data science techniques, can enable the development of dynamic species distribution models.  

# Data Collection

The status of Yellow Rails in the oilsands region has been poorly understood historically because they are not well surveyed by standard monitoring efforts. In 2012, the now-defunct Ecological Monitoring Committee for the Lower Athabasca began targeted surveys for Yellow Rails throughout the oilsands region. In the first year, human point counts and autonomous recording units (ARUs) were both employed in surveys, but it was quickly determined that ARUs are as good or better than humans at detecting Yellow Rails, and have the added benefit that they do not require humans to venture to remote areas at night. ARUs have been the sole survey method since 2013. 

Yellow Rails are surveyed through listening to recordings made at 2:00am during peak breeding season, which runs from roughly May 20 to July 15 each year. At 2:00am, we have found that Yellow Rails are highly vocal and easily detected, such that a 3-minute survey has a ~60% probability of detecting a Yellow Rail, given that one is present. Therefore, at each station surveyed in a given year, four 2:00am recordings are listened to to detect the presence of rail. The four recordings are randomly sampled from the available days between June 1 and July 15. Conducting multiple surveys per station allows estimation of both occupancy rate and detection probability via occupancy analysis (discussed in the results section below).

Just 2 Yellow Rails were detected at 302 survey stations in 2012 (0.007 individuals per sation); these findings initiated an iterative process whereby detections were used to refine our understanding of habitat preferences, which was then used to identify additional sites to survey. As evidence of the effectiveness of this process, at 102 stations that were visited for the first time in 2018 and had high predicted suitability, we found 22 Yellow Rail individuals (0.22 individuals per station, more than 30 times the rate of detections in 2012).

Once a wetland has been selected for surveys, multiple ARUs are usually placed within the wetland. The most common deployment scheme is to place five ARUs in a square with 600m edges: one unit is placed at each corner, and one in the middle. Variations on this theme have been used, with the general intent of placing ARUs sufficiently far (>500m) from their nearest neighbours to increase spatial independence. Each ARU placement is considered a 'site' in the analysis below, and displayed on the map.

In addition to visiting new sites, we have resurveyed previous survey locations, which will allow an assessment of inter-annual variation in site occupancy and analysis of trends over time. As of 2018, 143 survey stations with at least one Yellow Rail detection had been surveyed in multiple years.

# Results

## Key Breeding Sites in the OSR

We set out to identify and monitor key Yellow Rail breeding sites in the OSR, as per our first objective.

In the map below, the reader can filter the data in several ways, including by survey year (2013-2018), regionally important wetland habitat, or whether a Yellow Rail was detected at a particular site. Seven regionally important wetlands (or wetland complexes) are listed in Table 1, and are the source of 249 of 286 (87%) of the individual males detected from 2013 to 2018 via acoustic surveys. The Eastern and Western McClelland Fen Mine sites, represented by the cluster of sites north of Fort McMurray, have together produced 118 (41%) detections over the period surveyed. No other wetland site has so far been found to contain more than 10 individuals. For smaller wetlands, the number of detected males may represent a reasonable population estimate of males at the wetland; however, for larger wetlands where only a portion of the wetland has been sampled, this is likely an underestimate.   

<br>
<br>
```{r site-map, include=TRUE, echo=FALSE, message=FALSE, warning=FALSE, eval=TRUE, out.width="100%", fig.height=9}

df_occ_summary <- df_occupy %>%
  mutate(occupied = ifelse(occupied == 1, TRUE, FALSE)) %>%
  group_by(ss, year) %>%
  summarise(yera_occupied = ifelse(any(occupied), TRUE, FALSE)) %>%
  ungroup() %>%
  mutate(yera_occupied = as.factor(ifelse(is.na(yera_occupied), "NOT SURVEYED", yera_occupied)),
         yera_occupied = fct_relevel(yera_occupied, "TRUE")) %>%
  left_join(df_meta, by = "ss") %>%
  rename(lat = latit, long = longit)

# Create df of lease centroids for labels
df_centers <- sf_lease %>%
  st_centroid() %>%
  as_Spatial()

# Create palette 
pal1 <- colorFactor(palette = c("yellow", "#7f2704", "grey50"), 
                   domain = df_occ_summary$yera_occupied)

# Convert to SharedData object for crosstalk capability
shared_ss <- SharedData$new(df_occ_summary)

# Create interactive filters
bscols(widths = c(3, 3, NA),
         filter_checkbox("yera_occupied", "Yellow Rail Detection", shared_ss, ~yera_occupied),
         # Will try to figure out a way to have a default selection.
         filter_select("year", "Survey Year", shared_ss, ~year, multiple = FALSE, selected = "2013"),
         filter_checkbox("wetland", "Regionally Important Wetlands", shared_ss,
                  ~wetland)
)

# Leaflet map
sf_osr %>%
  st_transform("+init=epsg:4326") %>%
  leaflet() %>%
  addTiles() %>%
  addProviderTiles("Stamen.Terrain") %>%
  addProviderTiles("Esri.WorldImagery", group = "Satellite Imagery") %>%
  addFullscreenControl() %>%
  addResetMapButton() %>%
  addScaleBar(position = "bottomleft",
              options = scaleBarOptions(imperial = FALSE)) %>%
  addMapPane(name = "OSR Boundary", zIndex = 410) %>%
  addMapPane(name = "Lease Boundaries", zIndex = 420) %>%
        
  # Add OSR polygon
  addPolylines(color = "#0a0909", weight = 2.5, smoothFactor = 0.2, 
               opacity = 3.0, fill = FALSE, 
               group = "Alberta Oil Sands Region Boundary",
               options = leafletOptions(pane = "OSR Boundary")) %>%
  
  # Add lease sites polygon
  addPolylines(data = sf_lease, color = "#0a0909", weight = 1.5, smoothFactor = 0.2,
               opacity = 3.0, fill = FALSE,
               group = "Nearby Oil Sands Lease Sites",
               options = leafletOptions(pane = "Lease Boundaries")) %>%
  
  # Lease labels
  addLabelOnlyMarkers(data = df_centers, label = ~Name, 
                      group = "Nearby Oil Sands Lease Sites",
                      labelOptions = labelOptions(
                        noHide = TRUE, textOnly = FALSE, textsize = "10px",
                        opacity = 1, offset = c(0,0)
                      )) %>%
        
  # Add markers for survey stations
  addCircleMarkers(data = shared_ss, color = ~pal1(yera_occupied),
                   stroke = FALSE, fillOpacity = 1, radius = 7,
                   popup = paste("Site Code:", "<b>", df_occ_summary$ss)) %>%
        
  # Add legend
  addLegend(data = shared_ss, pal = pal1, values = ~yera_occupied,
            position = "bottomright", opacity = 1.0,
            title = "Yellow Rail Detection") %>%
        
  # Add layers control
  addLayersControl(overlayGroups = c("Alberta Oil Sands Region Boundary",
                                      "Satellite Imagery",
                                     "Nearby Oil Sands Lease Sites"),
                   options = layersControlOptions(collapsed = FALSE)) %>%
        
  hideGroup(c("Satellite Imagery", "Nearby Oil Sands Lease Sites"))

```
<br>

```{r wetlands-table, include=TRUE, echo=FALSE, message=FALSE, warning=FALSE, eval=TRUE}

df_wetlands <- data.frame(
  "Wetland" = c("Eastern McClelland Fen Mine", "Western McClelland Fen Mine",
                "Grazing Lease 820577", "Southern Cold Lake", "Marguerite Lake Wetlands",
                "West of Touchwood PRA", "Northwest of Janvier"),
  "Sites" = c(140, 71, 10, 15, 14, 5, 20),
  "Males" = c(65, 53, 47, 30, 27, 15, 12),
  "Size" = c(52.2, 17.3, 3.4, 4.4, 7.4, 0.8, 9))

kable(df_wetlands, align = c("l", "r", "r", "r"),
      col.names = c("Wetland", "Number of Monitoring Sites", 
                    "Number of Males Detected", "Habitat Size (km2)"),
      caption = "Regionally Important Wetlands for Yellow Rail Breeding Habitat in the OSR.")

```

## Trend Analysis

### Methods

For this analysis we estimated a dynamic site-occupancy model (MacKenzie et al., 2003), which allows for inference about the occurrence of Yellow Rail at collections of sites, and about how changes in occurrence are driven by local colonization and extinction. These models are dynamic in the sense that they are applied to multiple "periods" (years, in our case) and allow for between-period occurrence dynamics (i.e. a rail may be present one year, but not the next). In a monitoring context such as ours, site occupancy probabilities can be used as a metric to reflect the current state of the population of interest (MacKenzie et al., 2003).   

Dynamic occupancy models are also able to account for imperfect detection probability (i.e., a rail can go unobserved at a site during a particular survey, even if it is there). An occupancy model may be seriously biased if detection error is unaccounted for (Moilanen, 2002; Royle and Dorazio, 2008). This bias is manifested as underestimates of site occupancy and inflated estimates of species turnover rate, where apparent recolonization of a site is actually just due to non-detection of a species actually present.  

We use the package `unmarked` (Kery and Chandler, 2016) to fit a dynamic occupancy model to our Yellow Rail data using the function `colext()` in R v3.6.1 (R Core Team, 2019). To better understand variation within the region, we subset our data into four geographic areas and occupancy analysis is conducted on each: the Eastern McClelland Fen Mine (n = 140), Western McCelland Fen Mine (71), all Mineable Areas (226), and Non-Mineable Areas (269). The analysis is conducted using all sites together as well (Full Region). 

### Detection, Colonization, and Extinction

Detection is the proportion of visits to a site where a species is detected. Rather than using this straight proportion, this model accounts for imperfect detection probability using the method described in MacKenzie et al (2003). 

Detection probability by regional subset is displayed in Figure \@ref(fig:detection-comb) below, followed by the full region (Figure \@ref(fig:detection-full)). The error bars represent 90% confidence intervals in the estimated detection parameter.  

```{r detection-comb, include=TRUE, echo=FALSE, message=FALSE, warning=FALSE, eval=TRUE, out.width="90%", fig.cap="Estimated Yellow Rail detection probability in four regional subsets.", fig.height=6, fig.showtext=TRUE, dpi=1000}

# Extract detection, colonization, and extinction information.
df_output <- OUT %>%
  map_df(~ bind_rows(.x[2:4]), .id = "region") %>%
  mutate(region = case_when(
    region == "East" ~ "Eastern McClelland Fen Mine",
    region == "West" ~ "Western McClelland Fen Mine",
    region == "LAPR" ~ "Full Region",
    region == "Mine" ~ "Mineable Areas",
    region == "NoMine" ~ "Non-Mineable Areas")) %>%
  mutate(Parameter = factor(Parameter, 
                            levels = c("Detection", 
                                       "Colonization", 
                                       "Extinction")),
         region = factor(region,
                         levels = c("Full Region",
                                    "Western McClelland Fen Mine",
                                    "Eastern McClelland Fen Mine",
                                    "Mineable Areas",
                                    "Non-Mineable Areas")),
         #Year = as.numeric(Year),
         lower = ifelse(upper - lower > 0.9, NA, lower),
         upper = ifelse(upper - lower > 0.9, NA, upper))

plot1 <- df_output %>%
  mutate(Year = as.numeric(as.character(Year))) %>%
  filter(Parameter == "Detection" & !region == "Full Region") %>%
  ggplot(aes(x = Year, y = Predicted)) +
  geom_point(aes(color = region), size = 3.5) + 
  geom_line(aes(color = region)) +
  geom_errorbar(aes(y = Predicted, ymin = lower, ymax = upper, color = region), 
                width = 0.15) +
  scale_y_continuous(breaks = seq(0, 1, 0.2), limits = c(0, 1)) +
  scale_x_continuous(breaks = seq(2013, 2021, 1)) +
  scale_color_brewer(palette = "Dark2") +
  theme_bw() +
  labs(y = "Detection Probability",
       caption = "Number of sites: 71 (West), 140 (East), 226 (Mineable), 269 (Non-Mineable)") +
  guides(color = guide_legend(nrow = 2, byrow = TRUE)) +
  theme_abmi() +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_text(size = 13, angle = 45, hjust = 1),
        axis.title.y = element_text(size = 17, face = "bold"),
        axis.text.y = element_text(size = 10),
        legend.position = "bottom",
        legend.title = element_blank(),
        legend.text = element_text(size = 10),
        strip.text.x = element_blank(),
        panel.spacing.x = unit(1, "lines"),
        panel.spacing.y = unit(1.75, "lines"),
        plot.caption = element_text(face = "italic", size = 8, hjust = 0.5),
        panel.grid.major.x = element_line()) + 
  facet_wrap(~ region, nrow = 2)
  
plot1

#ggsave(here("./docs/pics/detection-comb.png"))

```
<br>

``` {r detection-full, include=TRUE, echo=FALSE, message=FALSE, warning=FALSE, eval=TRUE, out.width="60%", fig.height=5, fig.cap="Estimated Yellow Rail detection probability through the full study region.", fig.showtext=TRUE, dpi=1000}

plot2 <- df_output %>%
  mutate(Year = as.numeric(as.character(Year))) %>%
  filter(Parameter == "Detection" & region == "Full Region") %>%
  ggplot(aes(x = Year, y = Predicted)) +
  geom_point(size = 5, aes(color = region)) +
  geom_line(aes(color = region)) +
  geom_errorbar(aes(y = Predicted, ymin = lower, ymax = upper), 
                width = 0.15, color = "steelblue") +
  scale_color_manual(values = "steelblue") +
  scale_y_continuous(breaks = seq(0, 1, 0.2), limits = c(0, 1)) +
  scale_x_continuous(breaks = seq(2013, 2021, 1)) +
  theme_bw() +
  labs(y = "Detection Probability",
       caption = "Number of sites: 495") +
  theme_abmi() +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_text(size = 13, angle = 45, hjust = 1),
        axis.title.y = element_text(size = 16, face = "bold"),
        axis.text.y = element_text(size = 12),
        legend.position = "bottom",
        legend.title = element_blank(),
        legend.text = element_text(size = 15),
        plot.caption = element_text(face = "italic", size = 10, hjust = 0.5),
        panel.grid.major.x = element_line())  
  
plot2

#ggsave(here("./docs/pics/detection-full.png"))

```
<br>

Detection probability can be influenced by a variety of factors. First, individuals may call less in a given year for unknown reasons.  This could lead to lower detection rates but stable occupancy. Alternatively, detection rates increase when there are more individuals present at a location (Bayne et al. 2017). Thus, the decline we see in detection rates may reflect the species still occupying the same number of sites but fewer individuals being present at some sites leading to lower detection rates (i.e. the same number of sites are occupied but fewer individuals are present at each site). We are currently working on analyses that use the count of yellow rails at each site.

Changes in occurrence of a species can be driven by rates of both colonization and extinction at a set of local sites. Colonization is probability that an unoccupied site becomes occupied in the next period; conversely, extinction (or alternatively, survival) describes the probability that an occupied site continues to be occupied in the next period.

Predicted colonization and extinction parameters are displayed below for each regional subset (Figure \@ref(fig:ec-comb)), followed by the two parameters for a full regional model (Figure \@ref(fig:ec-full)). Error bars represent a 90% confidence interval in the estimated colonization and extinction parameters.

<br>
```{r ec-comb, include=TRUE, echo=FALSE, message=FALSE, warning=FALSE, eval=TRUE, out.width='100%', fig.cap="Local Yellow Rail colonization and extinction probabilities in four regional subsets.", fig.showtext=TRUE, dpi=1000, fig.height=6}

plot3 <- df_output %>%
  mutate(Year = as.numeric(as.character(Year))) %>%
  filter((Parameter == "Colonization" | Parameter == "Extinction") & !region == "Full Region") %>%
  ggplot(aes(x = Year, y = Predicted)) +
  geom_point(aes(color = region), size = 3.5) + 
  geom_line(aes(color = region)) +
  geom_errorbar(aes(y = Predicted, ymin = lower, ymax = upper, color = region), 
                width = 0.15) +
  scale_y_continuous(breaks = seq(0, 1, 0.2), limits = c(0, 1)) +
  scale_x_continuous(breaks = seq(2013, 2019, 1)) +
  scale_color_brewer(palette = "Dark2") +
  theme_bw() +
  labs(y = "Probability",
       caption = "Number of sites: 71 (West), 140 (East), 226 (Mineable), 269 (Non-Mineable)") +
  theme_abmi() +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_text(size = 9, angle = 45, hjust = 1),
        axis.title.y = element_text(size = 15, face = "bold"),
        axis.text.y = element_text(size = 10),
        legend.position = "bottom",
        legend.title = element_blank(),
        legend.text = element_text(size = 8),
        strip.text.x = element_blank(),
        strip.text.y = element_text(size = 10, face = "bold"),
        strip.background = element_rect(fill = "white"),
        panel.spacing.x = unit(1, "lines"),
        panel.spacing.y = unit(1.75, "lines"),
        plot.caption = element_text(face = "italic", size = 8, hjust = 0.5),
        panel.grid.major.x = element_line()) + 
  facet_grid(Parameter ~ region)

plot3

#ggsave(here("./docs/pics/extinction-colonization-comb.png"))

```
<br>
``` {r ec-full, include=TRUE, echo=FALSE, message=FALSE, warning=FALSE, eval=TRUE, out.width="60%", fig.cap="Local Yellow Rail colonization and extinction probability for the full study region.", fig.showtext=TRUE, dpi=1000, fig.height=6}

plot4 <- df_output %>%
  mutate(Year = as.numeric(as.character(Year))) %>%
  filter((Parameter == "Colonization" | Parameter == "Extinction") & region == "Full Region") %>%
  ggplot(aes(x = Year, y = Predicted)) +
  geom_point(aes(color = region), size = 4) +
  geom_errorbar(aes(y = Predicted, ymin = lower, ymax = upper, color = region), 
                width = 0.15) +
  geom_line(aes(color = region)) +
  scale_color_manual(values = "steelblue") +
  scale_y_continuous(breaks = seq(0, 0.8, 0.2), limits = c(0, 0.85)) +
  theme_bw() +
  labs(x = "Year",
       y = "Probability",
       caption = "Number of sites: 495") +
  theme_abmi() +
  theme(axis.text.x = element_text(size = 14, angle = 45, hjust = 1),
        axis.title.x = element_blank(),
        axis.title.y = element_text(size = 16, face = "bold"),
        axis.text.y = element_text(size = 14),
        strip.text.x = element_blank(),
        strip.text.y = element_text(size = 12, face = "bold"),
        strip.background = element_rect(fill = "white"),
        legend.position = "bottom",
        legend.title = element_blank(),
        legend.text = element_text(size = 14),
        # panel.border = element_blank(),
        panel.spacing.y = unit(1.5, "lines"),
        plot.caption = element_text(face = "italic", size = 10, hjust = 0.5),
        panel.grid.major.x = element_line()) +
  facet_grid(Parameter ~ region)

plot4

#ggsave(here("./docs/pics/extinction-colonization-full.png"))

```
<br>

The high rates of extinction and colonization show that the local dynamics of the Yellow Rail are highly variable over time. Thus, any short-term disappearance from a site (i.e. the Western McLelland fen) is not neccesarilly cause for concern as there is reasonable probability that they will recolonize the area when water levels are appropriate (see occupancy discussion below).

### Occupancy

Occupancy, adjusted for imperfect detection, is estimated for each of the four regional subsets between 2013 and 2018, and the results are displayed in Figure \@ref(fig:occ-comb). Occupancy is also estimated for the full region and displayed in Figure \@ref(fig:occ-full). 

<br>
``` {r occ-comb, include=TRUE, echo=FALSE, message=FALSE, warning=FALSE, eval=TRUE, out.width="90%", fig.cap="Estimated Yellow Rail occupancy in four regional subsets.", fig.showtext=TRUE, dpi=1000, fig.height=6}

df_output_occ <- OUT %>%
  map(~ data.frame(.x[1])) %>%
  map_dfr(~ rownames_to_column(.x[1:8], var = "status"), .id = "region") %>%
  gather(key = "year", value = "occupancy", Occupancy.1:Occupancy.8) %>%
  mutate(year = case_when(
    year == "Occupancy.1" ~ "2013",
    year == "Occupancy.2" ~ "2014",
    year == "Occupancy.3" ~ "2015",
    year == "Occupancy.4" ~ "2016",
    year == "Occupancy.5" ~ "2017",
    year == "Occupancy.6" ~ "2018",
    year == "Occupancy.7" ~ "2019",
    year == "Occupancy.8" ~ "2021"),
         region = case_when(
    region == "East" ~ "Eastern McClelland Fen Mine",
    region == "West" ~ "Western McClelland Fen Mine",
    region == "LAPR" ~ "Full Region",
    region == "Mine" ~ "Mineable Areas",
    region == "NoMine" ~ "Non-Mineable Areas"
  ))

plot5 <- df_output_occ %>%
  filter(status == "occupied",
         !region == "Full Region") %>%
  mutate(year = as.numeric(year),
         region = factor(region, levels = c("Western McClelland Fen Mine",
                                            "Eastern McClelland Fen Mine",
                                            "Mineable Areas",
                                            "Non-Mineable Areas"))) %>%
  ggplot(mapping = aes(x = year, y = occupancy)) +
  geom_point(mapping = aes(color = region), size = 3.5) +
  geom_line(mapping = aes(color = region)) +
  scale_y_continuous(breaks = seq(0, 1, 0.2), limits = c(0, 1)) +
  scale_x_continuous(breaks = seq(2013, 2021, 1)) +
  scale_color_brewer(palette = "Dark2") +
  theme_bw() +
  labs(x = "Year",
       y = "Proportion of Sites Occupied",
       # title = "Occupancy rates in four regions of the Lower Athabasca",
       caption = "Number of sites: 71 (West), 140 (East), 226 (Mineable), 269 (Non-Mineable)") +
  guides(color = guide_legend(nrow = 2, byrow = TRUE)) +
  theme_abmi() +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.title.y = element_text(size = 17, face = "bold"),
        axis.text.y = element_text(size = 10),
        legend.position = "bottom",
        legend.title = element_blank(),
        legend.text = element_text(size = 9),
        strip.text.x = element_blank(),
        panel.spacing.x = unit(1, "lines"),
        panel.spacing.y = unit(1.75, "lines"),
        plot.caption = element_text(face = "italic", size = 8, hjust = 0.5),
        panel.grid.major.x = element_line()) +
  facet_wrap(~ region, nrow = 2) 

plot5

#ggsave(here("./docs/pics/occ-comb.png"))

```
<br>

```{r occ-full, include=TRUE, echo=FALSE, message=FALSE, warning=FALSE, eval=TRUE, out.width="65%", fig.cap="Estimated Yellow Rail occupancy for the full study region.", fig.showtext=TRUE, dpi=1000}

plot6 <- df_output_occ %>%
  filter(status == "occupied",
         region == "Full Region") %>%
  mutate(year = as.numeric(year)) %>%
  ggplot(mapping = aes(x = year, y = occupancy)) +
  geom_point(size = 5, aes(color = region)) +
  geom_line(aes(color = region)) +
  scale_color_manual(values = "steelblue") +
  scale_y_continuous(breaks = seq(0, 0.5, 0.1), limits = c(0, 0.5)) +
  scale_x_continuous(breaks = seq(2013, 2021, 1)) +
  theme_bw() +
  labs(x = "Year",
       y = "Proportion of Sites Occupied",
       caption = "Number of sites: 495") +
  theme_abmi() +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_text(size = 12, angle = 45, hjust = 1),
        axis.title.y = element_text(size = 16, face = "bold"),
        axis.text.y = element_text(size = 12),
        legend.position = "bottom",
        legend.title = element_blank(),
        legend.text = element_text(size = 15),
        panel.grid.major.x = element_line(),
        plot.caption = element_text(face = "italic", size = 10, hjust = 0.5))

plot6

#ggsave(here("./docs/pics/occ-full.png"))

```
<br>

One aspect of the data worth noting is the drop in occupancy rates in 2018 in the Western McLelland fen. Occupancy rates were approximately 0.45 in 2017, and dropped to 0 in 2018. This may be a cause for concern from a conservation perspective, as this section of wetland is adjacent to ongoing developments (Suncor Fort Hills mine). However, a causal link cannot yet be drawn for a few reasons. First, consistent with the existing literature on this species, Yellow Rail occupancy fluctuates greatly year-to-year in individual wetlands. Linking changes in occupancy to causal mechanisms is complicated by the inherent noisiness of the data. Second, the potential decline occurred only in the most recent year; until 2018, the number of occupied Yellow Rail sites had been consistently increasing in the Mineable region. Additional years of data would be helpful to assess whether this represents a change in habitat suitability or simply natural fluctuations. In fact, data from 2013 also showed low occupancy rates in the western fen, suggesting 2018 may not have been anomalous. Data from 2019 showed occupancy remained low in the mineable region and increased at the more southerly sites. We caution that the increase in more southerly sites is partially an artifact of reduced sampling caused by a reduced budget. We priortized visiting sites  in southern regions in 2019 that have more consistently had Yellow Rails.

### Further Analysis

To better understand the between-year dynamics of Yellow Rail occupancy, certain environmental conditions or attributes of each site could be added as covariates to the occupancy model. Evidence suggests that Yellow Rail are sensitive to changes in water levels, and even modest changes in hydrology may render habitat unsuitable as a breeding site (Austin and Buhl, 2013; COSEWIC, 2009). Where oil sands development (or potential development) encrouches upon Rail habitat (such as around McClelland Lake), changes to hydrology may pose as big a threat as direct habitat removal. Adding measurements of water depth levels taken during field sampling to the occupancy model may help explain variation in occupancy rates both between years and between sites. Since 2013, water depth levels have been recored at 0, 10, 20, 30, 40 and 50-m intervals in four directions (SE, SW, NE, and NW) from each monitoring site.

Preliminary work has been done to include water measurements in a model of Yellow Rail occupancy, which will be presented in an updated version of this report. Below is displayed boxplots of the distribution in predicted water depth for each year and for three regions of interest: the Eastern McClelland Fen Mine, Western McClelland Fen Mine (\@ref(fig:water-depth-mcclelland)), and unmineable sites (\@ref(fig:water-depth-unmineable))[^1]. A mixed effect model was used, with the log transform of water depth at the response, year and date as independent variables, and monitoring site as a random effect. A Poisson link function was used.   

[^1]: A substantial amount of data cleaning is required, with small number of measurements collected for some regions in some years. 

```{r water-depth-mcclelland, include=TRUE, echo=FALSE, message=FALSE, warning=FALSE, eval=TRUE, out.width="50%", fig.show="hold", fig.cap="Water depth in the Western (left) and Eastern (right) McClelland Fen Mine, by year."}

include_graphics(c(here("./results/figures/WESTWaterDepthByYear.jpeg"), here("./results/figures/EASTWaterDepthByYear.jpeg")))

```

``` {r water-depth-unmineable, include=TRUE, echo=FALSE, message=FALSE, warning=FALSE, eval=TRUE, out.width="50%", fig.cap="Water depth in the Unmineable region."}

include_graphics(here("./results/figures/unmineableWaterDepthByYear.jpeg"))

```

Distance to mine edge has also been hypothesized as an important predictor of Yellow Rail occupancy at surveyed sites. The map below outlines how mine footprint (ABMI, 2017) has changed near McClelland Lake (both west and east portions of the fen) throughout the study period, along with variation in site occupancy. Mine encroachment does not appear to alter spatial patterns of rail occupancy, as detections are found both close to and far from mine edges. However, further work will be required to test this effect. Figure \@ref(fig:mine-encroach) below shows how oil sands mine footprint has changed over the study period around McClelland Lake fen.  

<br>

```{r mine-encroach-gif, include=FALSE, echo=FALSE, message=FALSE, warning=FALSE, eval=FALSE}

sf_mine <- st_read(here("./data/base/spatial/mine-encroachment.shp")) %>%
  mutate(YEAR = ifelse(YEAR == 0, 2018, YEAR))  %>%
  st_transform("+init=epsg:4326")

sf_2019 <- sf_mine %>%
  filter(YEAR == "2018") %>%
  mutate(YEAR = 2019)

sf_mine_all <- sf_mine %>%
  rbind(sf_2019)

sf_sites <- df_occ_summary %>%
  rename(YEAR = year) %>%
  filter(wetland == "McClelland Lake Fen - West" | wetland == "McClelland Lake Fen - East") %>%
  rename(`Rail Detection` = yera_occupied) %>%
  mutate(`Rail Detection` = fct_relevel(`Rail Detection`, c("NOT SURVEYED", "FALSE", "TRUE"))) %>%
  st_as_sf(coords = c("long", "lat"), crs = "+init=epsg:4326")

encroach <- ggplot(data = sf_sites) +
  geom_sf(aes(color = `Rail Detection`, fill = `Rail Detection`), size = 1) +
  geom_sf(data = sf_mine_all, fill = "grey80", color = "black") +
  scale_color_manual(values = c("grey40", "#7f2704", "#dbdb1a")) +
  scale_fill_manual(values = c("grey40", "#7f2704", "#dbdb1a")) +
  theme_void() +
  facet_wrap(~ YEAR) +
  #labs(title = 'Year: {current_frame}') +
  theme(legend.title = element_text(size = 10),
        legend.text = element_text(size = 8),
        legend.spacing = unit(0, "cm"),
        legend.position = "bottom",
        plot.title = element_text(size = 12, face = "bold")) #+
  #transition_manual(YEAR)

#grid.draw(shift_legend(encroach))
#ggsave(here("./docs/pics/mine-encroach-2019.png"), dpi = 500)

#anim_save(here("./docs/pics/encroach.gif"))

```

```{r mine-encroach, include=TRUE, echo=FALSE, message=FALSE, warning=FALSE, eval=TRUE, out.width="60%", fig.cap="Patterns of Yellow Rail presence in relation to mine footprint between 2013 and 2019."}

include_graphics(here("./docs/pics/encroach.gif"))

```
<br>

## Threats to Known Breeding Sites

Several oil sands leases overlap with important breeding sites for Yellow Rails in the OSR, most notably the west and east areas of the McLelland Lake Fen. This interconnected fen complex contains a vast area of suitable habitat and large numbers of breeding individuals each year. The reader can view this overlap in the above map through the 'Nearby Oil Sands Lease Sites' layer. 

The western portion of the McClelland Lake Fen is overlapped by the Fort Hills Oil Sands Project lease. About 55% of the identified suitable habitat in the area lies within the lease, a portion which includes 66% (35 of 53) of the Yellow Rails detected in the western McClelland Lake Fen since 2012. 

A number of developments, or proposed developments, overlap with Yellow Rail habitat on the eastern portion of the McClelland Lake fen as well. Rails have been detected in the proposed footprint of both the Jackpine Mine Phase 2 and Kearl Oil Sands Projects (30% of individuals detected in the area since 2012). Yellow Rails were also detected in Aurora Mine South, and although no detections have been recorded recently, past surveys have recored Rails in the Muskeg River Mine Project lease area (Hatfield Consultants, 2008). The next section discusses the potential Yellow Rail habitat in each lease area, much of which has yet to be surveyed. 

# Planning Tools 

## Habitat Suitability Map

Results from Yellow Rail site surveys between 2012-2017 were used to produce a map of preferred habitat across a subset of the OSR. Four mapping products were used to build this final 'fusion' model: 

+ Alberta Biodiversity Monitoring Institute (ABMI) 2010 Landcover Classification. This product is an Alberta-wide ('wall-to-wall') provincial land cover based on digital classification of Landsat satellite imagery and enhanced using GIS datasets obtained from the Government of Alberta. It consists of 15 classes, including water, shrubland, grassland, agriculture, exposed land, developed land, and various forest types.
+ Ducks Unlimited Enhanced Wetland Classification. This is a western boreal product based on a combination of Landsat and Radarsat. Using object-based supervised classification methods this product identifies 19 boreal plans wetland classes and 10 other land cover classes.
+ Landcover Classification of Canada. Based on MODIS satellite observations from 2005, the product identifies 39 classes of landcover. 
+ Alberta Vegetation Inventory. AVI is a photo-based digital inventory developed to identify the type, extent and conditions of vegetation. Human observers digitize polygons into a series of forest type classes that include various non-forested categories. Environment and Climate Change Canada (Edmonton) created a classification system from the AVI that converted the underlying attributes into 37 unique classes of which nine represent wetland types.

Each of the four products were either available in, or converted to, a 30-m raster. We used a resource selection function approach based on the logistic discriminant approach (Manly et al. 2002) to determine whether each land-cover class within four distinct mapping products was avoided, neutral, or selected.  A land-cover class that was avoided had a beta coefficient that was negative and a 95% confidence interval that did not include zero. A land-cover class that had a beta coefficient that was positive and 95% confidence interval that did not include zero was selected. All other land-cover classes were declared neutral.  For each mapping product, we then ranked avoided habitat as 0, neutral as 1, and selected as 2. We mapped the predicted selection class for each land-cover class in each mapping product. To combine these four maps into a composite map (the fusion map), we took the sum of the four RSF maps for each 30-m cell across the region. An 8 was a spatial location where all products agreed that Yellow Rail selected that area while a 0 was a spatial location where all products agreed was avoided. Mapped values between 1 and 7 indicate the degree of consistency and the direction of selection with intermediate values being spatial locations where there was more uncertainty between mapping products in terms of whether the land-cover was selected or avoided. 

In order for a habitat map to be considered predictive, higher occupancy rates should be found in areas identified as more suitable. Targeted monitoring was undertaken in 2018 at previously unsurveyed locations to assess whether the habitat map could reliably predict Yellow Rail occupancy. Using occupancy modeling, it was confirmed that locations with higher predicted suitability had higher occupancy rates (Hedley et al, *in prep*). Only three individuals were detected at two locations in habitat classes zero through six, while 20 were detected in classes seven (4) and eight (16) (Hedley et al, *in prep*). By restricting future survey effort to the most suitable habitats, Yellow Rails can be encountered more efficiently in the future with more successful site identification. 

The interactive map below displays the predicted habitat suitability for Yellow Rail in the subset of the OSR. The area of the map is restricted to the area covered by each of the four input mapping products. Note that although the mapping product was developed at a 30-m resolution, it is displayed here at larger resolution to improve rendering speeds.   

<br>
```{r habitat-map, include=TRUE, echo=FALSE, message=FALSE, warning=FALSE, eval=TRUE, out.width="100%", fig.height=9}

# Define palette
pal_rev <- rev(brewer.pal(9, "RdBu"))
pal1 <- colorNumeric(palette = pal_rev, 
                         domain = values(ras_prefhab), 
                         na.color = "transparent")

ras_prefhab <- raster(here("./data/base/spatial/yera_prefhab_250m.tif"))

# EPSG:3785
crs(ras_prefhab) = CRS("+proj=merc +lon_0=0 +k=1 +x_0=0 +y_0=0 +a=6378137 +b=6378137 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs")

# Leaflet map
map_prefhab <- sf_osr %>%
  st_transform(4326) %>%
  leaflet() %>%
  addTiles() %>%
  addProviderTiles("Stamen.Terrain") %>%
  addFullscreenControl() %>%
  addResetMapButton() %>%
  addScaleBar(position = "bottomleft",
              options = scaleBarOptions(imperial = FALSE)) %>%
  setView(lng = -111.64, lat = 56.31, zoom = 7) %>%
  addMapPane(name = "OSR Boundary", zIndex = 410) %>%
  addMapPane(name = "Lease Boundaries", zIndex = 420) %>%
  
  # Add OSR polygon
  addPolylines(color = "#0a0909", weight = 2, smoothFactor = 0.2, 
               opacity = 3.0, fill = FALSE, 
               group = "Alberta Oil Sands Region Boundary",
               options = leafletOptions(pane = "OSR Boundary")) %>%
  
  # Add lease sites polygon
  addPolylines(data = sf_lease, color = "#0a0909", weight = 2.5, smoothFactor = 0.2,
               opacity = 3.0, fill = FALSE,
               group = "Nearby Oil Sands Lease Sites",
               options = leafletOptions(pane = "Lease Boundaries")) %>%
  
  # Lease labels
  addLabelOnlyMarkers(data = df_centers, label = ~Name, 
                      group = "Nearby Oil Sands Lease Sites",
                      labelOptions = labelOptions(
                        noHide = TRUE, textOnly = FALSE, textsize = "10px",
                        opacity = 1, offset = c(0,0)
                      )) %>%

  # Add raster layer
  addRasterImage(ras_prefhab, colors = pal1, opacity = 1,
                 group = "Predicted Habitat Suitability", maxBytes = 5 * 1024 * 1024) %>%
  
  # Add legend
  addLegend(pal = pal1, values = values(ras_prefhab), opacity = 1,  
            title = "Predicted Habitat Suitability", position = "bottomright",
            group = "Predicted Habitat Suitability") %>%
  
  # Layers Control
  addLayersControl(overlayGroups = c("Predicted Habitat Suitability",
                                     "Alberta Oil Sands Region Boundary",
                                     "Nearby Oil Sands Lease Sites"),
                   options = layersControlOptions(collapsed = FALSE)) %>%
  
  hideGroup(c("Alberta Oil Sands Region Boundary", "Nearby Oil Sands Lease Sites"))

map_prefhab

```
<br>

The distribution of habitat classes in each of seven mining lease sites is displayed in Figure \@ref(fig:habitat-plots) below. Jackpine Mine Phase 2 contains the most high quality (classes 7 & 8) habitat within its boundaries, primarily in the northern portion of the lease where it overlaps with the Eastern McClelland Fen.

<br>
```{r habitat-plots, include=TRUE, echo=FALSE, message=FALSE, warning=FALSE, eval=TRUE, out.width="100%", fig.cap="Distribution of habitat classes in seven mining lease sites near McClelland Lake Fen.", dpi=1000}

df_lease <- st_set_geometry(sf_lease, NULL)

plot7 <- df_lease %>%
  gather(key = "Class", value = "Area", VALUE_0:VALUE_8) %>%
  mutate(Area = Area / 1000000) %>% # Convert from m2 to km2
  mutate(Class = as.factor(Class)) %>%
  # filter(Name == "Jackpine Mine Phase 2") %>%
  ggplot(aes(x = Class, y = Area, fill = Class)) +
  geom_col(color = "black") +
  scale_fill_manual(values = pal_rev, labels = c("0","1","2","3","4","5","6","7","8")) +
  guides(fill = guide_legend(title.position = "top",
                             label.position = "bottom",
                             nrow = 1)) +
  labs(y = expression(Area~(km^2))) +
  theme_classic() +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_text(size = 10),
        axis.title.x = element_blank(),
        axis.title.y = element_text(size = 14, face = "bold"),
        axis.ticks.x = element_blank(),
        axis.line.x = element_blank(),
        legend.direction = "horizontal",
        legend.spacing.x = unit(0, "cm")) +
  facet_wrap(~ Name) 

grid.draw(shift_legend(plot7))

```
<br>

## Spatially Explicit Abundance Modeling Using Satellite Remote Sensing

Advancements in remote sensing technologies have dramatically increased the breadth and resolution of landcover data available for ecological modeling purposes (Cord et al., 2013). Among these advancements has been the availability of open-access satellite data (e.g. Landsat, Sentinel-1, Sentinel-2), which when combined with cloud computing power (e.g. through Google Earth Engine) and data science software has made the inegration of remotely sensed data into applied ecological research possible. 

McLeod (2019) used the Yellow Rail abundance data collected throughout the OSM (and more broadly, the Lower Athabasca Region) to build a distribution model with landcover information directly derived from satellite data. This information included data obtained from Sentinel-1, Sentinel-2 (Copernicus Programme, 2017) and the Advanced Land Observing Satellite (ALOS) Digital Elevation Model (DEM) (JAXA, 2019), which were then processed using Google Earth Engine. A total of 15 input variables were used in the model to predict Yellow Rail abundance, including Anthocyanin Reflectance Index (ARI), the Normalized Difference of Polarization (DPOL), a topographic wetness index, and a Red Edge Inflection Point (REIP). A boosted regression tree modeling approach was used to fit the distribution model for Yellow Rail.

There are several inherent advantages to this approach of using remotely sensed data directly. First, it allows for avoidance of building models off prior models (e.g. landcover classifications), which compounds error rates (McLeod, 2019). Additionally, the continual collection of satellite data makes it possible to dynamically update a species distribution model with annual, or seasonal, remotely sensed inputs to better reflect changes within a dynamic wetland ecosystem (like those preferred by Yellow Rail) (McLeod, 2019).

Displayed below is a subset of the predictive map, which shows the predicted abundance of breeding Yellow Rail at a 10-m resolution in both the eastern and western portions of the McClelland Fen Mine area. Note that upland areas were excluded from the model's predicted area. As McLeod (2019) explains, the predicted abundances should be interpreted as an ordered rank where higher predictions equate to an increased likelihood that more individual Yellow Rail are present during the breeding season.  
<br>
```{r pred-map, include=TRUE, echo=FALSE, message=FALSE, warning=FALSE, eval=TRUE, out.width="100%", fig.height=7}

pred.bins <- c(0, 0.5, 1, 1.5, 2, 3, 4, 15.25104)
pal2 <- colorBin(palette = "viridis", values(ras_pred), bins = pred.bins, 
                 na.color = "transparent", pretty = TRUE)

map_pred <- 
  leaflet() %>%
  # addTiles() %>%
  addProviderTiles(providers$Esri.WorldImagery, group = "Satellite Imagery") %>%
  
  # Add raster layer
  addRasterImage(ras_pred, colors = pal2, opacity = 1,
                 group = "Predicted Rail Abundance") %>%
  
  addLegend(colors = pal2(c(0, 0.5, 1, 1.5, 2, 3, 4)), 
            labels = c("0-0.5", "0.5-1", "1-1.5", "1.5-2", "2-3", "3-4", "4+"), 
            opacity = 1,  
            title = "Predicted Rail Abundance", position = "bottomright",
            group = "Predicted Rail Abundance") %>%

  addLayersControl(overlayGroups = "Predicted Rail Abundance",
                   options = layersControlOptions(collapsed = FALSE))  

map_pred
  
```
<br>

The potential also exists for remote sensing techniques to help quantify water depth at survey site locations. As mentioned previously, water depth measurements were taken by field staff during the Yellow Rail monitoring program; however, in some cases, practical sampling difficulties has rendered parts of this dataset incomplete. Supplementing this information with radar data from satellites could potentially improve habitat modeling capabilities (e.g. Jiang et al., 2015).

Based on the very specific nature of YERA habitat, it is hypothesized that polarimetric Synthetic Aperture Radar (SAR) could also be very powerful for characterizing, mapping, and monitoring these wetland habitats. SAR is able to detect complex water vegetation interactions and also measure wetland vegetation structure. In this work, polarimetric SAR from RADARSAT-2 and optical data from Landsat were used to detect probable YERA wetland habitat and detect changes in habitat from year-to-year. It was found that SAR was much more important than optical data for mapping probable YERA habitat as it is able to detect flooded vegetation and the specific graminoid vegetation structure. These parameters from SAR were able to effectively characterize YERA habitat which seems to be consistent with field descriptions of YERA habitat (Figure \@ref(fig:eo)). Using these SAR inputs plus a few optical inputs from Landsat showed good prediction of YERA occupancy probability across wetland areas around the McLelland wetland complex (Figure \@ref(fig:eo2)). Trends in the SAR data proved to be somewhat inconclusive as intra-year variability these wetland habitats may be greater than the year-to-year trends. Overall, polarimetric SAR can be a powerful tool for monitoring hydrodynamic/structural changes in wetland habitat and thus monitoring of species distribution patterns such as YEAR.

```{r eo, include=TRUE, echo=FALSE, message=FALSE, warning=FALSE, eval=TRUE, out.width="90%", fig.cap="Distribution of habitat classes in seven mining lease sites near McClelland Lake Fen.", dpi=1000, fig.height=8, fig.showtext=TRUE}

b3_l8 <- read_csv(here("./data/processed/eo_modeling/B3_L8.csv")) %>%
  mutate(variable = "B3_L8") %>%
  select(variable, value = B3_L8, occ_prob = y)

b6_l8 <- read_csv(here("./data/processed/eo_modeling/B6_L8.csv")) %>%
  mutate(variable = "B6_L8") %>%
  select(variable, value = B6_L8, occ_prob = y)

crosspolratio <- read_csv(here("./data/processed/eo_modeling/CrossPolRatio.csv")) %>%
  mutate(variable = "CrossPolRatio") %>%
  select(variable, value = CrossPolRatio, occ_prob = y)

doublebounce_fd <- read_csv(here("./data/processed/eo_modeling/DoubleBounce_FD.csv")) %>%
  mutate(variable = "DoubleBounce_FD") %>%
  select(variable, value = DoubleBounce_FD, occ_prob = y)

roughsurface_fd <- read_csv(here("./data/processed/eo_modeling/RoughSurface_FD.csv")) %>%
  mutate(variable = "RoughSurface_FD") %>%
  select(variable, value = RoughSurface_FD, occ_prob = y)

volumescattering_fd <- read_csv(here("./data/processed/eo_modeling/VolumeScattering_FD.csv")) %>%
  mutate(variable = "VolumeScattering_FD") %>%
  select(variable, value = VolumeScattering_FD, occ_prob = y)

eo_modeling <- bind_rows(b3_l8, b6_l8, crosspolratio, doublebounce_fd, roughsurface_fd, volumescattering_fd)

plot8 <- eo_modeling %>%
  ggplot(aes(x = value, y = occ_prob)) +
  geom_smooth(method = "loess", aes(color = variable)) +
  geom_point(size = 0.6) +
  facet_wrap(~ variable, nrow = 3, scales = "free") +
  theme_abmi() +
  labs(y = "Occupancy Probability", x = "Optical Input Value") +
  theme(axis.title.y = element_text(size = 17, face = "bold"),
        axis.title.x = element_text(size = 15),
        strip.text = element_text(size = 13),
        legend.position = "none")

plot8

```


```{r eo2, include=TRUE, echo=FALSE, message=FALSE, warning=FALSE, eval=TRUE, out.width="80%", fig.cap="Hexagonal YERA occupancy probability for the study area. Yellows represent high YERA occupancy probability and darker colours represent low probabilities. Insets on right zoom in on areas with suitable YEAR habitat (center and graminoid areas of wetland habitat) and poor habitat (edge/treed wetland)."}

knitr::include_graphics(here("./docs/pics/eo2.png"))

```


## Understanding temporal dynamics using Landsat Imagery

In this analysis, we explored whether Landsat imagery could help explain the inter-annual variation in Yellow Rail occurrence, which can be highly unpredictable from year to year. First, we extracted Landsat variables from 468 stations and used them to assess habitat quality at each station in each year. Then, we assessed whether Yellow Rails colonized when conditions improved relative to the previous year, and left when conditions worsened relative to the previous year. This hypothesis is based on anecdotes in the literature that Yellow Rails require conditions to be just right in terms of water levels and other habitat features, leading to large fluctuations across years.

Here we will only briefly summarize the methods and results, but we point the reader to the report prepared by R.Hedley (2021) for additional details and analyses. To model habitat quality, we extracted eleven Landsat 8 variables, and used boosted regression trees to classify the probability of occupancy at a location in any given year. Via this procedure, a location with a high predicted occupancy probability (scored from 0 to 1) is expected to be high quality in that year, while a location with a low score was expected to be poor quality, and the scores of a station fluctuated from year to year along with changes in the Landsat imagery. We predicted that if Yellow Rails were tracking habitat conditions, that colonization events should occur when conditions improved relative to the previous year, and extinction events should occur when conditions declined. 

A key result is shown in \@ref(fig:landsat), which shows that neither colonizations nor extinctions were associated in any consistent way with the magnitude of the change in habitat quality score. In other words, the birds did not appear to be tracking habitat conditions.

```{r landsat, include=TRUE, echo=FALSE, message=FALSE, warning=FALSE, eval=TRUE, out.width="50%", fig.cap="Water depth in the Unmineable region."}

knitr::include_graphics(here("./docs/pics/landsat.jpg"))

```

A few limitations are worth noting. First of all, the Landsat 8 imagery itself may not be accurately capturing relevant on-the-ground conditions, such as water levels. We strongly suspect that this is the case, since the image acquisition dates varied across years, and our method for correcting for image acquisition date was thought to be imperfect. Second, our boosted regression tree models may not have captured habitat quality from the perspective of the rails. Finally, it is possible that the occurrence of rails might be largely random, or at least caused by factors not visible using remote sensing. Although there does appear to be a degree of unpredictability to the inter-annual dynamics of Yellow Rails, we suspect that this latter conclusion is premature, and that there are other factors at play. In our view the most likely explanation is the first one: that the relevant habitat features were simply not captured by Landsat imagery. In the next section, we compare the performance of Landsat imagery against Radarsat-2, to explore whether it may be more suitable for Yellow Rail habitat modeling.

## Regional Population Estimates

Hedley et al (*in prep*) used the results of the habitat suitability map, combined with occupancy modeling, to produce a regional population estimate for Yellow Rail[^1]. Occupancy rates in each habitat class (0-8) were extrapolated to the rest of the region using a hexagon grid methodology, where a hexagon grid is simulated across the study area and points are generated at the centroid. Two grid sizes, in terms of distance between centroids, were chosen based on assumptions about the detection radius of the ARUS, territory size, and territory shape (details available in Hedley et al, *in prep*): 802-m and 605-m. Once these grids were simulated across the landscape, occupancy rate was predicted at each cell according to the habitat class at the centroid. 

[^1]: Note that this regional population estimate applies to the area covered by the habitat suitability map, not the OSR as a whole. 

Using the larger grid size, which is based on an assumed effective ARU detection distance of 250-m, the total regional population size was estimated to be 1,597 males. With the smaller grid size, based on a effective detection distance of 150-m, the regional population estimate was 2,636 males. To put these numbers in context, the only previous population estimate for Alberta was 500 pairs for the entire province, based on expert opinion. We now believe that the population in the OSR alone likely exceeds this population estimate. 

The table below summarizes these findings, with 90% confidence intervals in brackets.

```{r population-table, include=TRUE, echo=FALSE, message=FALSE, warning=FALSE, eval=TRUE}

df_population <- data.frame(
  "Grid" = c("802", "605", "802", "605", "802", "605"),
  "Lease" = c("Off Lease", "-", "Leased", "-", "Total", "-"),
  "Area" = c(41970, "-", 6745, "-", 48715, "-"),
  "Pct" = c(86.2, "-", 13.9, "-", 100, "-"),
  "Rails" = c(144, "-", 55, "-", 199, "-"),
  "Pop" = c("1319 (300,2985)", "2192 (414,5107)", "278", "443", "1597 (394,3560)", "2636 (532,6078)"))

kable(df_population, align = c("l", "r", "r", "r", "r", "r"),
      col.names = c("Grid Size (m)", "Lease Status", 
                    "Area (km2)", "% of Total Area", "# Rails Detected", 
                    "Pop Estimate"),
      caption = "Estimated Yellow Rail population sizes.")

```

Relative to their share of the total area (13.9%), leased areas (both mining and *in situ*) account for a proportionally higher share of the estimated regional population of Yellow Rails (17%).  

# Discussion

The boreal forest of Alberta was formerly considered an area of secondary importance for Yellow Rails. This is no longer the case, as bioacoustic surveys conducted in the past decade have significantly increased the number of confirmed Yellow Rails in the OSR. It now seems likely that this region hosts a significant proportion of the global population of Yellow Rails.

Yellow Rails are not evenly distributed across the boreal forest, but are concentrated in large wetland complexes. Conservation efforts should focus on minimizing the effects of development within these important habitats. New tools are available that can help visualize Yellow Rail occurrence and identify breeding sites for surveys.

Placing the threat in a broader regional and global context is also important. Regionally, surveys should be conducted in more large wetland complexes with high predicted habitat suitability to identify new significant breeding sites or confirm their absence. Globally, efforts should be made to refine population estimates by synthesizing information across known breeding hotspots in each province.

# References 

Austin, J. E., & Buhl, D. A. (2013). Relating Yellow Rail ( Coturnicops noveboracensis ) Occupancy to Habitat and Landscape Features in the Context of Fire. Waterbirds, 36(2), 199213.

Bookhout, T. A., & Stenzel, J. R. (1987). Habitat and movements of breeding yellow rails. Wilson Bulletin, 99(3), 441447.

Copernicus Programme. (2017). Sentinel-2 User Handbook. Retrieved fromhttps://sentinels.copernicus.eu/web/sentinel/user-guides/document-library/-/asset_publisher/xlslt4309D5h/content/sentinel-2-user-handbook.

Cord, A. R., Meentemeyer, R. K., Leitao, P. J., & Vaclavik, T. (2013). Modelling species distributions with remote sensing data: bridging disciplinary perspectives. Journal of Biogeography, 40, 22262227.

COSEWIC. (2009). Assessment and Status Report on the Yellow Rail Coturnicops noveboracensis in Canada. Committee on the Staus of Endangered Wildlife in Canada.

Environment Canada. (2013). Management plan for the yellow rail (Coturnicops noveboracensis) in Canada. Species at Risk Act Management Plan Series.

Hatfield Consultants. (2008). Results of yellow rail surveys on the Albian Muskeg River mine expansion area. Retrieved from http://www.ceaa.gc.ca/050/documents_staticpost/59539/50567/Appx2Results.pdf.

Hedley, R., et al. (2019). Modeling the occurrence of the Yellow Rail (Coturnicops noveboracensis), a bird species of conservation concern, in the oil sands region of Alberta using bioacoustic survey data. *in prep*.

Jiang, H., Liu, C., Sun, X., Lu, J., Zou, C., Hou, Y., & Lu, X. (2015). Remote sensing reversion of water depths and water management for the stopover site of siberian cranes at Momoge, China. Wetlands, 35(2), 369379.

Leston, L., & Bookhout, T. A. (2015). Yellow Rail (Coturnicops noveboracensis), version 2.0. https://doi.org/10.2173/bna.139.

McLeod, L. (2019). Predictive Mapping of Yellow Rail (Coturnicops noveboracensis) Density and Abundance in the Western Boreal Forest via Ground and Satellite Remote Sensors. M.S Thesis. University of Alberta, Edmonton, Alberta. 103 Pages. 

Stenzel, J. R. (1982). Ecology of breeding yellow rails at Seney National Wildlife Refuge. M.S. Thesis. Ohio State University, Columbus, Ohio. 106 Pages.

Wells, J. V, & Blancher, P. J. (2011). Global role for sustaining bird populations. In J. V Wells (Ed.),
Boreal birds in North America: A hemispheric view of their conservation links and significance. Studies in Avian Biology (no. 41) (pp. 722). Berkeley, CA: University of California Press.














